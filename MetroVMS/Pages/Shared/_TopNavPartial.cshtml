 @inject MetroVMS.Localization.Services.LanguageLCService Localizer
@{
}
<div id="kt_app_header" class="app-header">
    <div class="app-container container-fluid d-flex align-items-stretch justify-content-between" id="kt_app_header_container">
        <div class="d-flex align-items-center d-lg-none ms-n3 me-1 me-md-2" title="Show sidebar menu">
            <div class="btn btn-icon btn-active-color-primary w-35px h-35px" id="kt_app_sidebar_mobile_toggle">
                <i class="ki-duotone ki-abstract-14 fs-2 fs-md-1">
                    <span class="path1"></span>
                    <span class="path2"></span>
                </i>
            </div>
        </div>

        <div class="d-flex align-items-center flex-grow-1 flex-lg-grow-0">
            <a href="#" class="d-lg-none">
                <img alt="Logo" src="~/media/logos/CoreLogo3.png" class="h-30px" />
            </a>
        </div>

        <div class="d-flex align-items-stretch justify-content-between flex-lg-grow-1" id="kt_app_header_wrapper">
            <div class="app-header-menu app-header-mobile-drawer align-items-stretch" data-kt-drawer="true" data-kt-drawer-name="app-header-menu" data-kt-drawer-activate="{default: true, lg: false}" data-kt-drawer-overlay="true" data-kt-drawer-width="250px" data-kt-drawer-direction="end" data-kt-drawer-toggle="#kt_app_header_menu_toggle" data-kt-swapper="true" data-kt-swapper-mode="{default: 'append', lg: 'prepend'}" data-kt-swapper-parent="{default: '#kt_app_body', lg: '#kt_app_header_wrapper'}">
                <div class="menu menu-rounded menu-column menu-lg-row my-5 my-lg-0 align-items-stretch fw-semibold px-2 px-lg-0" id="kt_app_header_menu" data-kt-menu="true">
                </div>
            </div>

            <div class="app-navbar flex-shrink-0">
                <!--begin::Sign In / Sign Out Buttons-->
                <div class="app-navbar-item d-flex align-items-center ms-3 gap-2">

                    <div class="dropdown me-2">
                        <a class="btn btn-success btn-sm dropdown-toggle d-flex align-items-center justify-content-center"
                           href="#" role="button" id="quickInDropdown" data-bs-toggle="dropdown"
                           aria-expanded="false" style="width: 120px;">
                            <i class="ki-duotone ki-login fs-3 me-1"></i>
                            <span>Quick In</span>
                        </a>

                        <div class="dropdown-menu dropdown-menu-end shadow-lg rounded-3"
                             aria-labelledby="quickInDropdown"
                             style="width: 700px; max-height: 550px; overflow-y: auto; padding: 2rem;">

                            <!-- Heading -->
                            <div class="pb-3 mb-4 border-bottom">
                               @*  <h6 class="fw-bold text-success border-bottom pb-2 mb-3"> *@
                                    <h6 class="fw-bold text-success m-0">
                                    <i class="fas fa-sign-in-alt me-2 text-muted"></i> Quick In
                                </h6>
                            </div>

                            <form id="quickInForm">
                                <div class="row g-4">
                                    <!-- increased gap from g-3 to g-4 -->
                                    <div class="col-md-4">
                                        <label class="form-label fw-semibold">Visitor No</label>
                                        <input type="text" id="VisitorNo" class="form-control form-control-sm" readonly />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-semibold">Department</label>
                                        <select id="DepartmentId" class="form-select form-select-sm">
                                            <option value="">Select Department</option>
                                            <option>HR</option>
                                            <option>Finance</option>
                                            <option>IT</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-semibold">Purpose of Visit</label>
                                        <select id="PurposeId" class="form-select form-select-sm">
                                            <option value="">Select Purpose</option>
                                            <option>Meeting</option>
                                            <option>Delivery</option>
                                            <option>Interview</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-semibold">Staff</label>
                                        <input type="text" id="StaffToVisit" class="form-control form-control-sm" placeholder="Enter staff name" />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-semibold">Full Name</label>
                                        <input type="text" id="FullName" class="form-control form-control-sm" placeholder="Visitor name" />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-semibold">Civil ID</label>
                                        <input type="text" id="CivilID" class="form-control form-control-sm" />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-semibold">Mobile Number</label>
                                        <input type="text" id="MobileNumber" class="form-control form-control-sm" />
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label fw-semibold">Visitor Badge No</label>
                                        <input type="text" id="VisitorBadgeNo" class="form-control form-control-sm" />
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label fw-semibold">Visit Remark</label>
                                        <textarea id="VisitRemark" class="form-control form-control-sm" rows="3"></textarea>
                                    </div>
                                </div>

                                <!-- Footer Buttons -->
                                <div class="text-end mt-4 pt-3 border-top">
                                    <button type="submit" class="btn btn-success btn-sm me-2">
                                        <i class="fas fa-check-circle me-1"></i> Save
                                    </button>
                                    <button type="button" class="btn btn-light btn-sm" data-bs-toggle="dropdown">
                                        Close
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- ✅ QUICK OUT DROPDOWN -->
                    <div class="dropdown">
                        <a class="btn btn-danger btn-sm dropdown-toggle d-flex align-items-center justify-content-center"
                           href="#" role="button" id="quickOutDropdown" data-bs-toggle="dropdown"
                           aria-expanded="false" style="width: 120px;">
                            <i class="ki-duotone ki-logout fs-3 me-1"></i>
                            <span>Quick Out</span>
                        </a>

                        <div class="dropdown-menu dropdown-menu-end shadow-lg rounded-3"
                             aria-labelledby="quickOutDropdown"
                             style="width: 900px; max-height: 550px; overflow-y: auto; padding: 2rem;">

                            <!-- Heading -->
                            <div class="pb-3 mb-4 border-bottom">
                                <h6 class="fw-bold text-danger m-0">
                                    <i class="fas fa-door-open me-2 text-muted"></i> Quick Out
                                </h6>
                            </div>

                            <!-- Search Input -->
                            <div class="mb-4">
                                <label class="form-label fw-semibold">Search Visitor</label>
                                <div class="input-group input-group-sm">
                                    <input type="text" id="visitorSearchInput" class="form-control" placeholder="Search by Badge No, Mobile, or Civil ID..." />
                                    <button class="btn btn-primary" id="btnSearchVisitor">
                                        <i class="fas fa-search"></i> Search
                                    </button>
                                </div>
                            </div>

                            <!-- Table -->
                            <div class="table-responsive rounded-3">
                                <table class="table table-hover table-bordered align-middle mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Visitor No</th>
                                            <th>Full Name</th>
                                            <th>Badge No</th>
                                            <th>Mobile</th>
                                            <th>Civil ID</th>
                                            <th>Department</th>
                                            <th>Purpose</th>
                                            <th>In Time</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="visitorOutTable">
                                        <tr>
                                            <td colspan="9" class="text-center text-muted py-3">Loading active visitors...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- Footer Buttons -->
                            <div class="text-end mt-4 pt-3 border-top">
                                <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="dropdown">
                                    Close
                                </button>
                            </div>
                        </div>
                    </div>

                </div>
                <!--end::Sign In / Sign Out Buttons-->

                <!---------------------- Employee Name & DP ---------------------->
                <div class="app-navbar-item ms-1 ms-md-3" id="kt_header_user_menu_toggle">
                    <div class="cursor-pointer symbol symbol-30px symbol-md-40px  user-margin" data-kt-menu-trigger="{default: 'click', lg: 'hover'}" data-kt-menu-attach="parent" data-kt-menu-placement="bottom-end">
                        <span class="text-muted"> @User?.FindFirst("Username")?.Value</span>
                        <img src="~/media/landing_page/300-3.jpg" alt="employee" class="w-25px h-25px rounded-circle ms-2" />
                    </div>
                    <div class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-800 menu-state-bg menu-state-color fw-semibold py-4 fs-6 w-275px" data-kt-menu="true">
                        <div class="menu-item px-3 ">
                            <div class="menu-content d-flex align-items-center px-3">
                                <div class="d-flex flex-column">
                                    <div class="fw-bold d-flex align-items-center fs-5">
                                        @User?.FindFirst("Username")?.Value
                                    </div>
                                    <a href="#" class="fw-semibold text-muted text-hover-primary fs-7">  @User?.FindFirst("Email")?.Value</a>
                                </div>
                            </div>
                        </div>
                        <div class="separator my-2"></div>
                        <div class="menu-item px-5">
                            <a href="javascript:;" class="menu-link ChangePage" src="UserProfile">My Profile</a>
                        </div>
                        <div class="menu-item px-5">
                            <a href="#" id="logOutUser" class="menu-link px-5">Log Out</a>
                        </div>
                    </div>
                </div>

                <div class="app-navbar-item d-lg-none ms-2 me-n2" title="Show header menu">
                    <div class="btn btn-flex btn-icon btn-active-color-primary w-30px h-30px" id="kt_app_header_menu_toggle">
                        <i class="ki-duotone ki-element-4 fs-1">
                            <span class="path1"></span>
                            <span class="path2"></span>
                        </i>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>

    $(function () {

   

          // Load dummy visitor data when dropdown opens
    $('#quickOutDropdown').on('show.bs.dropdown', function () {
        const visitors = [
            { no: '001', name: 'John Doe', badge: 'B123', mobile: '90012345', civil: '2987654321', dept: 'HR', purpose: 'Meeting', inTime: '09:15 AM' },
            { no: '002', name: 'Mary Smith', badge: 'B456', mobile: '98765432', civil: '3009876543', dept: 'IT', purpose: 'Interview', inTime: '10:05 AM' }
        ];

        let rows = visitors.map(v => `
            <tr>
                <td>${v.no}</td>
                <td>${v.name}</td>
                <td>${v.badge}</td>
                <td>${v.mobile}</td>
                <td>${v.civil}</td>
                <td>${v.dept}</td>
                <td>${v.purpose}</td>
                <td>${v.inTime}</td>
                <td>
                    <button class="btn btn-sm btn-danger btnMarkOut" data-id="${v.no}" data-name="${v.name}" title="Mark Visitor Out">
                        <i class="fas fa-door-open"></i>
                    </button>
                </td>
            </tr>`).join('');

        $('#visitorOutTable').html(rows);
    });

    // Handle visitor search
    $('#btnSearchVisitor').on('click', function () {
        const query = $('#visitorSearchInput').val().trim();
        if (!query) {
            Swal.fire("Enter a value", "Please enter Badge No, Mobile, or Civil ID to search.", "info");
            return;
        }
        Swal.fire("Search", `Searching for visitor: ${query}`, "info");
    });

    // Handle Quick Out action
    $(document).on('click', '.btnMarkOut', function () {
        const name = $(this).data('name');
        Swal.fire("Visitor Checked Out", `${name} has been successfully marked as OUT.`, "success");
        $(this).closest('tr').fadeOut();
    });









        // Close dropdown when clicking outside
        $(document).on("click", function (e) {
            if (!$(e.target).closest('.dropdown').length) {
                $('.dropdown-menu.show').removeClass('show');
            }
        });

        // Handle Quick In
        $('#quickInForm').on('submit', function (e) {
            e.preventDefault();
            const name = $(this).find('input:first').val();
            if (name) {
                Swal.fire("Success", `Visitor ${name} marked IN successfully.`, "success");
                $(this)[0].reset();
                $('.dropdown-menu.show').removeClass('show');
            }
        });

        // Handle Quick Out
        $('#btnMarkOuttest').on('click', function () {
            const search = $('#searchVisitor').val();
            if (search) {
                Swal.fire("Marked Out", `Visitor with ID/Mobile ${search} marked OUT.`, "success");
                $('.dropdown-menu.show').removeClass('show');
            } else {
                Swal.fire("Error", "Please enter visitor details.", "error");
            }
        });
    });
</script>
